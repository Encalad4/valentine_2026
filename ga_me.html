<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emoji Merge üíñ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #fff0f3;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

h1 {
  margin: 16px 0;
  color: #d6336c;
}

.grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  width: 90%;
  max-width: 420px;
}

.tile {
  background: white;
  border-radius: 18px;
  height: 72px;
  font-size: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: grab;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  user-select: none;
  touch-action: none;
}

.tile.dragging {
  opacity: 0.5;
  cursor: grabbing;
}

/* === INSTRUCTIONS === */

.instructions {
  margin-top: 20px;
  width: 90%;
  max-width: 420px;
  background: white;
  border-radius: 18px;
  padding: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.12);
  font-size: 0.9rem;
  line-height: 1.4;
}

.instructions h2 {
  margin: 8px 0;
  color: #d6336c;
  font-size: 1.1rem;
}

.instructions ul {
  padding-left: 18px;
  margin: 8px 0;
}

.hierarchy {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
}

.hierarchy span {
  background: #fff0f3;
  border-radius: 12px;
  padding: 6px 10px;
  font-size: 1.1rem;
}

/* === MODAL === */

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
  z-index: 1000;
}

.modal-overlay.show {
  opacity: 1;
  pointer-events: auto;
}

.modal {
  background: white;
  border-radius: 22px;
  padding: 24px;
  width: 90%;
  max-width: 360px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  animation: pop 0.3s ease;
}

.modal h2 {
  margin: 0 0 12px;
  font-size: 2rem;
}

.modal p {
  font-size: 1rem;
  margin-bottom: 20px;
}

.modal-buttons {
  display: flex;
  gap: 12px;
}

.btn {
  flex: 1;
  border: none;
  border-radius: 14px;
  padding: 10px;
  font-size: 0.95rem;
  cursor: pointer;
}

.btn.accept {
  background: #ffd6e0;
}

.btn.super-accept {
  background: #ff8fab;
  color: white;
  font-weight: bold;
}

@keyframes pop {
  from {
    transform: scale(0.9);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}
</style>
</head>

<body>

<h1>Mezcla los emojis üíï</h1>

<div class="grid" id="grid"></div>
<div class="instructions" id="instructions"></div>

<!-- === MODAL === -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h2>üíå</h2>
    <p id="modal-text">Aqu√≠ va tu mensaje üíñ</p>
    <div class="modal-buttons">
      <button class="btn accept">Acepto</button>
      <button class="btn super-accept">Re contra acepto</button>
    </div>
  </div>
</div>

<script>
/* =======================
   GAME CONFIGURATION
======================= */

const HIERARCHY = [
  "üíß", "üå±", "üåø", "üå∏", "ü¶ã",
  "üíï", "‚ù§Ô∏è", "üíñ", "üíå", "üìú"
];

const BASIC = "üíß";
const GRID_SIZE = 12;

const SOUNDS = [
  "sounds/yipi.mp3",
  "sounds/nice.mp3",
  "sounds/kiss.mp3",
  "sounds/eso.mp3",
  "sounds/besha.mp3"
];

/* =======================
   STATE
======================= */

let tiles = JSON.parse(localStorage.getItem("tiles")) ||
  Array(GRID_SIZE).fill(BASIC);

let draggedIndex = null;

const grid = document.getElementById("grid");
const instructions = document.getElementById("instructions");
const modal = document.getElementById("modal");
const modalText = document.getElementById("modal-text");

/* =======================
   UTILITIES
======================= */

function save() {
  localStorage.setItem("tiles", JSON.stringify(tiles));
}

function playSound() {
  const src = SOUNDS[Math.floor(Math.random() * SOUNDS.length)];
  const audio = new Audio(src);
  audio.volume = 0.6;
  audio.play();
}

function nextEmoji(emoji) {
  const i = HIERARCHY.indexOf(emoji);
  return i >= 0 && i < HIERARCHY.length - 1
    ? HIERARCHY[i + 1]
    : null;
}

/* =======================
   RENDER GRID (DESKTOP + MOBILE)
======================= */

function render() {
  grid.innerHTML = "";

  tiles.forEach((emoji, index) => {
    const tile = document.createElement("div");
    tile.className = "tile";
    tile.textContent = emoji;
    tile.dataset.index = index;
    tile.draggable = true;

    /* === DESKTOP DRAG === */
    tile.addEventListener("dragstart", () => {
      draggedIndex = index;
      tile.classList.add("dragging");
    });

    tile.addEventListener("dragend", () => {
      draggedIndex = null;
      tile.classList.remove("dragging");
    });

    tile.addEventListener("dragover", e => e.preventDefault());
    tile.addEventListener("drop", () => handleDrop(index));

    /* === MOBILE TOUCH === */
    tile.addEventListener("touchstart", () => {
      draggedIndex = index;
      tile.classList.add("dragging");
    });

    tile.addEventListener("touchend", e => {
      tile.classList.remove("dragging");
      const touch = e.changedTouches[0];
      const target = document.elementFromPoint(touch.clientX, touch.clientY);
      const targetTile = target?.closest(".tile");
      if (targetTile) {
        handleDrop(Number(targetTile.dataset.index));
      }
      draggedIndex = null;
    });

    grid.appendChild(tile);
  });
}

/* =======================
   INSTRUCTIONS
======================= */

function renderInstructions() {
  instructions.innerHTML = `
    <h2>üìñ C√≥mo se juega</h2>
    <ul>
      <li>Arrastra (o desliza) un emoji sobre otro igual.</li>
      <li>Al mezclarlos, evolucionan.</li>
      <li>El original vuelve a ${BASIC}.</li>
    </ul>

    <h2>üèÅ Fin del juego</h2>
    <p>
      El juego termina cuando creas:
      <strong>${HIERARCHY[HIERARCHY.length - 1]}</strong>.
    </p>

    <h2>üîó Jerarqu√≠a</h2>
    <div class="hierarchy">
      ${HIERARCHY.map(e => `<span>${e}</span>`).join("‚Üí")}
    </div>
  `;
}

/* =======================
   MODAL LOGIC
======================= */

function showModal(text) {
  modalText.textContent = text;
  modal.classList.add("show");
}

function hideModal() {
  modal.classList.remove("show");
}

modal.querySelectorAll(".btn").forEach(btn =>
  btn.addEventListener("click", hideModal)
);

/* =======================
   GAME LOGIC
======================= */

function handleDrop(targetIndex) {
  if (draggedIndex === null || draggedIndex === targetIndex) return;

  const a = tiles[draggedIndex];
  const b = tiles[targetIndex];

  if (a === b) {
    const upgraded = nextEmoji(a);
    if (upgraded) {
      tiles[targetIndex] = upgraded;
      tiles[draggedIndex] = BASIC;
      playSound();
      save();

      if (upgraded === "üìú") {
        setTimeout(() => {
          showModal(
            "Hola coraz√≥n, completaste el juego jeje"+
            ". \n\nEspero te hayas divertido, porque se lo mucho que te envisian este tipo de juegos jajaja. Te amo mucho mucho mucho mi amor, y hay una cosa que te quer√≠a preguntar... "+
            "\n\n¬øQuieres ser mi valentine el 14 de febrero? üíñ"
          );
        }, 200);
      }
    }
  }

  render();
}

/* =======================
   START
======================= */

render();
renderInstructions();
</script>

</body>
</html>
